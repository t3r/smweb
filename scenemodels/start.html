<!DOCTYPE html>
<html lang="en">
<head>
  <title>FlightGear Scenery</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/dropzone/4.3.0/min/dropzone.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.4.1/knockout-min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/dropzone/4.3.0/min/dropzone.min.js"></script>
  <style>    
    /* Set black background color, white text and some padding */
    nav {
/* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#5c5c5c+0,818181+50,757575+51,b3b3b3+100 */
background: #5c5c5c; /* Old browsers */
background: -moz-linear-gradient(top, #5c5c5c 0%, #818181 50%, #757575 51%, #b3b3b3 100%); /* FF3.6-15 */
background: -webkit-linear-gradient(top, #5c5c5c 0%,#818181 50%,#757575 51%,#b3b3b3 100%); /* Chrome10-25,Safari5.1-6 */
background: linear-gradient(to bottom, #5c5c5c 0%,#818181 50%,#757575 51%,#b3b3b3 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#5c5c5c', endColorstr='#b3b3b3',GradientType=0 ); /* IE6-9 */
    }

    .navbar-inverse .navbar-nav > .active > a, .navbar-inverse .navbar-nav > .active > a:focus, .navbar-inverse .navbar-nav > .active > a:hover {
/* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#2f1e9a+0,332ad8+50,2b20ca+51,817ee8+100 */
background: #2f1e9a; /* Old browsers */
background: -moz-linear-gradient(top, #2f1e9a 0%, #332ad8 50%, #2b20ca 51%, #817ee8 100%); /* FF3.6-15 */
background: -webkit-linear-gradient(top, #2f1e9a 0%,#332ad8 50%,#2b20ca 51%,#817ee8 100%); /* Chrome10-25,Safari5.1-6 */
background: linear-gradient(to bottom, #2f1e9a 0%,#332ad8 50%,#2b20ca 51%,#817ee8 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
filter: progid:DXImageTransform.Microsoft.gradient( startColorstr='#2f1e9a', endColorstr='#817ee8',GradientType=0 ); /* IE6-9 */
    }

    footer {
      background-color: #555;
      color: white;
      padding: 15px;
    }
    .statscounter {
      font-weight: bold;
      font-size: 110%;
    }
    ol {
      padding-left: 0;
    }
  </style>
</head>
<body>

<nav class="navbar navbar-inverse">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>                        
      </button>
      <a class="navbar-brand" href="#" title="FlightGear SceneModels Database" style="padding: 0"><img style="width:100%; height: 100%;"
             src="/img/FlightGear_logo.svg"></a>
    </div>
    <div class="collapse navbar-collapse" id="myNavbar">
      <ul class="nav navbar-nav">
        <li class="active"><a href="#">Home</a></li>
        <li><a href="#">Contribute</a></li>
        <li><a href="#">Models</a></li>
        <li><a href="#">Objects</a></li>
        <li><a href="#">Authors</a></li>
      </ul>
      <form class="navbar-form navbar-right" role="search">
        <div class="form-group input-group">
          <input type="text" class="form-control" placeholder="Search..">
          <span class="input-group-btn">
            <button class="btn btn-default" type="button">
              <span class="glyphicon glyphicon-search"></span>
            </button>
          </span>        
        </div>
      </form>
      <ul class="nav navbar-nav navbar-right">
        <li><a href="#"><span class="glyphicon glyphicon-user"></span> My Account</a></li>
      </ul>
    </div>
  </div>
</nav>
  
<div class="container-fluid">    
  <div class="row">
    <div class="col-sm-3 well">
      <h4>Quick Submit</h4>
      <div class="panel-group" id="accordion">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">New Model</a>
            </h4>
          </div>
          <div id="collapseOne" class="panel-collapse collapse">
            <div class="panel-body">
              <form class="form-horiontal" action=" https://api.flightgear.org/scenemodels/models/fileupload" method="POST">
                <div class="form-group">
                  <div class="input-group" data-bind="css: newModelNameStatus">
                    <span class="input-group-addon">1.</span>
                    <input type="text" class="form-control" placeholder="Give me a name" data-bind="textInput: newModelName">
                  </div>
                  <div class="input-group" data-bind="css: newModelDescriptionStatus">
                    <span class="input-group-addon">2.</span>
                    <input type="text" class="form-control" placeholder="And a description" data-bind="enable: newModelNameValid, textInput: newModelDescription">
                  </div>
                  <div class="input-group" data-bind="css: ''">
                    <span class="input-group-addon">3.</span>
                    <div class="form-control dropzone" id="newmodelupload" action=" https://api.flightgear.org/scenemodels/models/fileupload"></div>
                  </div>
                  <div class="input-group" data-bind="css: ''">
                    <span class="input-group-addon">4.</span>
                    <a class="btn btn-block btn-default">4. Place on map</a>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
        <div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo">New Position</a>
            </h4>
          </div>
          <div id="collapseTwo" class="panel-collapse collapse">
            <div class="panel-body">
              <p>Foo</p>
            </div>
          </div>
        </div>
      </div>
      <!--
      <div class="alert alert-success fade in">
        <a href="#" class="close" data-dismiss="alert" aria-label="close">Ã—</a>
        <p><strong>Ey!</strong></p>
        People are looking at your profile. Find out who.
      </div>
      <p><a href="#">Link</a></p>
      <p><a href="#">Link</a></p>
      <p><a href="#">Link</a></p>
      -->
    </div>
    <div class="col-sm-6">
    
      <div class="row">
        <div class="col-sm-12">
          <div class="panel panel-default text-left">
            <div class="panel-body">
<h1>Welcome to the <a href="http://www.flightgear.org">FlightGear</a> scenery website!</p></h1>
    <p>This is the central point for maintaining FlightGear scenery models and their positions. All data on this site is available under the GNU General Public License 2. Everybody is welcome to contribute.</p>
            </div>
          </div>
        </div>
      </div>

      <!-- ko foreach: latestModels2 -->
      <div class="row">
        <!-- ko foreach: $data -->
        <div class="col-sm-6">
          <div class="well">
            <div class="label label-default" style="max-width: 320px; display: block"><span data-bind="text: name"></span> (<span data-bind="text: author"></span>)</div>
            <img data-bind="attr: { src: thumbUrl(), alt: name, title: name }" class="img-responsive img-rounded" alt="Avatar">
            <div class="label label-default" style="max-width: 320px; display: block" data-bind="text: notes"></div>
            <div class="label label-default" style="max-width: 320px; display: block" data-bind="text: modified"></div>
          </div>
        </div>
        <!-- /ko -->
      </div>
      <!-- /ko -->

    </div>

    <div class="col-sm-3 well text-left">
      <h4>Statistics</h4>
      <div class="well">
        <ul class="list-group">
          <li class="list-group-item"><span class="badge" data-bind="text: numModels"></span> Models</li>
          <li class="list-group-item"><span class="badge" data-bind="text: numObjects"></span> Objects</li>
          <li class="list-group-item"><span class="badge" data-bind="text: numAuthors"></span> Authors</li>
          <li class="list-group-item"><span class="badge" data-bind="text: numPending"></span> Pending</li>
        </ul>
      </div>
      <div class="well">
        <h4>Top Authors</h4>
        <p><strong>all time</strong>
        <ol class="list-group" data-bind="foreach: topAuthor">
          <li class="list-group-item"><span data-bind="text: author"></span><span class="badge" data-bind="text: count"></span></li>
        </ol></p>
        <p><strong>last 90 days</strong>
        <ol class="list-group" data-bind="foreach: topAuthor90">
          <li class="list-group-item"><span data-bind="text: author"></span><span class="badge" data-bind="text: count"></li>
        </ol></p>
      </div>
<!--
      <div class="thumbnail">
        <p>Upcoming Events:</p>
        <img src="paris.jpg" alt="Paris" width="400" height="300">
        <p><strong>Paris</strong></p>
        <p>Fri. 27 November 2015</p>
        <button class="btn btn-primary">Info</button>
      </div>      
      <div class="well">
        <p>ADS</p>
      </div>
      <div class="well">
        <p>ADS</p>
      </div>
-->
    </div>
  </div>
</div>

<footer class="container-fluid text-center">
  <p>Footer Text</p>
</footer>

<script type="text/javascript">

      $(function() {
Dropzone.options.newmodelupload = {
  url: '/scenemodels/models/fileupload',
  paramName: "file", // The name that will be used to transfer the file
  maxFilesize: 2, // MB
 dictDefaultMessage: '3. Drop Model.ac, texture.png and thumbnail.jpg here',
  accept: function(file, done) {
    console.log("upload accept:",file)
      var fileNameLower = file.name.toLowerCase()
      if( !(fileNameLower.endsWith(".png") || fileNameLower.endsWith(".ac") || fileNameLower.endsWith(".jpg") || fileNameLower.endsWith(".xml")) ) {
        return done("Invalid file type")
      }
    else { done(); }
  }
}

        function ViewModel() {
          var self = this;
          self.latestModels = ko.observableArray([]);
          self.latestModels2 = ko.observableArray();
          self.latestOffset = ko.observable(0);
          self.latestCount = ko.observable(10);
          self.numModels = ko.observable(0);
          self.numObjects = ko.observable(0);
          self.numAuthors = ko.observable(0);
          self.numPending = ko.observable(0);
          self.topAuthor = ko.observable([]);
          self.topAuthor90 = ko.observable([]);

          self.newModelName = ko.observable()
          self.newModelNameValid =  ko.pureComputed(function() { 
            return (self.newModelName() || '').trim().length >= 5
          })
          self.newModelNameStatus = ko.pureComputed(function() { 
            return self.newModelNameValid() ? 'has-success' : 'has-error';
          })

          self.newModelDescription = ko.observable()
          self.newModelDescriptionValid =  ko.pureComputed(function() { 
            return(self.newModelDescription() || '').trim().length >= 5
          })
          self.newModelDescriptionStatus = ko.pureComputed(function() { 
            return self.newModelDescriptionValid() ? 'has-success' : 'has-error';
          })


          self.reloadLatestModels()
          self.reloadStatistics()
          self.reloadTopAuthors()
        }

        ViewModel.prototype.reloadTopAuthors = function() {
          var self = this;
          $.getJSON( "/scenemodels/stats/models/byauthor/3/", function( data ) {
            self.topAuthor(data.modelsbyauthor)
          })
          $.getJSON( "/scenemodels/stats/models/byauthor/3/0/1", function( data ) {
            self.topAuthor90(data.modelsbyauthor)
          })
        }

        ViewModel.prototype.reloadStatistics = function() {
          var self = this;
          $.getJSON( "/scenemodels/stats/", function( data ) {
            data = data || {};
            stats = data.stats || {}
            self.numModels( stats.models || 0);
            self.numObjects( stats.objects || 0);
            self.numAuthors( stats.authors || 0);
            self.numPending( stats.pending || 0);
          });
        }

        ViewModel.prototype.reloadLatestModels = function() {
          var self = this
          $.getJSON( "https://scenery.flightgear.org/scenemodels/models/list/" + this.latestCount() + "/" + this.latestOffset(), function(data) {
            data.forEach(function(d) {
              d.thumbUrl = function() {
                return "/scenemodels/model/" + d.id + "/thumb";
              }
            })

            self.latestModels(data) 
            self.latestModels2.removeAll()
            for( var i = 0; i < data.length; i++ ) {
              var m2 = [ data[i++] ];
              if( i < data.length )
                m2.push( data[i] )
              self.latestModels2.push( m2 );
            }
          });
        }

        ko.applyBindings( new ViewModel() )
      });
</script>

</body>
</html>

